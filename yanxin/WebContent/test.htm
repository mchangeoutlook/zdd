<html>
	<head>
		<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8"/>
		<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<meta name="mobileoptimized" content="0"/>
		<link rel="shortcut icon" href="logo.png" type="image/x-icon" />
		<title>言心 你的心灵日记 陪伴有故事的你</title>
		<meta name="description" content="言心 你的心灵日记 陪伴有故事的你" />
  		<meta name="Keywords" content="言心 你的心灵日记 陪伴有故事的你" />
  		<style type="text/css">
  			input[type="button"]{
  				background:#008B8B;border:none;color:#eee;border-radius:4px;line-height:30px;height:30px;font-size:20px;
  			}
  			input[type="text"]{
  				background:#ddd;border:none;padding-left:4px;padding-right:4px;height:30px;border-radius:4px;font-size:20px;
  			}
  			textarea{
  				background:#ddd;border:none;padding:4px;border-radius:4px;font-size:20px;
  			}
  			input[type="password"]{
  				background:#ddd;border:none;padding-left:4px;padding-right:4px;height:30px;border-radius:4px;font-size:20px;
  			}
  			body{
  				background:#000;
  			}
  			.divroot{
  				position:fixed;
  				left:1vw;
  				right:1vw;
  				top:1vw;
  				bottom:1vw;
  				color:#ddd;
  				background:#000;
  				font-size:20px;
  				overflow:hidden;
  			}
  			.divsecondtop{
  				position:absolute;
  				overflow:hidden;
  				top:0px;
  				left:0px;
  				right:0px;
  				bottom:92px;
  			}
  			
  			.divsecondbottom{
  				position:absolute;
  				overflow:hidden;
  				height:92px;
  				left:0px;
  				right:0px;
  				bottom:0px;
  			}

			.load{
				animation: loading 0.4s ease 0s alternate infinite;
			}  			
			@keyframes loading
			{
				0%{opacity:1;}
				20%{opacity:1;}
				100%{opacity:0.2;}
			}
  			
  			.msgfoot{
  				position:absolute;
  				text-align:center;
  				word-wrap:break-word;
  				bottom:-54px;
				left:0px;
				right:0px;
				height:54px;
				font-size:16px;
				line-height:18px;
  				border:0px;
  				overflow-x:hidden;
  				overflow-y:auto;
  				color:#f4a57e;
  				text-align:left;
  				animation: msgfooting 0.5s ease 0s forwards;
  			}  			
			@keyframes msgfooting
			{
				0%{transform:translateY(0%);}
				100%{transform:translateY(-100%);}
			}

			.msgpop{
				position:absolute;
				text-align:center;
				border-radius:4px;
				word-wrap:break-word;
				padding:20px;
				font-size:16px;
				top:10px;
				left:10px;
				right:10px;
				bottom:92px;
				overflow-x:hidden;
				overflow-y:auto;
				background-color:#e0bb95;
				color:#000;
				border:0px;
				text-align:left;
				animation: msgpoping 0.8s ease 0s forwards;
			}  			
			@keyframes msgpoping
			{
				0%{transform:scale(0);}
				100%{transform:scale(1);}
			}
			.yximgwrite{
				position:absolute;
				top:0px;
				left:0px;
				right:0px;
				bottom:50%;
				overflow:hidden;
			}
			
			.yxinputswrite{
				position:absolute;
				top:50%;
				left:0px;
				right:0px;
				bottom:0px;
				overflow:hidden;
			}
			.yximgread{
				position:absolute;
				top:0px;
				left:0px;
				right:0px;
				bottom:50%;
				overflow:hidden;
			}
			
			.yxinputsread{
				position:absolute;
				top:50%;
				left:0px;
				right:0px;
				bottom:0px;
				overflow:hidden;
			}
			
			@media (min-aspect-ratio: 1/1){
				.yximgwrite{
					position:absolute;
					top:0px;
					left:0px;
					right:50%;
					bottom:0px;
					overflow:hidden;
				}
				
				.yxinputswrite{
					position:absolute;
					top:0px;
					left:50%;
					right:0px;
					bottom:0px;
					overflow:hidden;
				}
				.yximgread{
					position:absolute;
					top:0px;
					left:0px;
					right:50%;
					bottom:0px;
					overflow:hidden;
				}
				
				.yxinputsread{
					position:absolute;
					top:0px;
					left:50%;
					right:0px;
					bottom:0px;
					overflow:hidden;
				}
			}
			
  			.opening{
  				position:absolute;
  				z-index:20000;
  				background:black;
  				border:0px;
  				width:300px;
  				height:300px;
  				left:50%;
  				top:50%;
  				overflow:hidden;
  				transform:translateX(-50%) translateY(-50%);
  			}
  			.book{
  				position:absolute;
  				border:0px;
  				width:25px;
  				height:2px;
  				left:52px;
  				top:154px;
  			}
  			.thick{
  				position:absolute;
  				border:0px;
  				background-color:#96b6b5;
  				width:25px;
  				height:2px;
  				left:0px;
  				top:0px;
  				animation: thicking 5s linear 0s forwards;
  			}
  			@keyframes thicking
			{
				0%{background-color:#96b6b5;}
				99%{background-color:#96b6b5;}
				100%{background-color:white;}
			}
			.text{
				position:absolute;
				text-align:center;
				font-size:16px;
				width:170px;
				color:#ddd;
				top:50%;
				left:100%;
				animation: texting 3s ease 0s forwards;
  			}
  			@keyframes texting
			{
				0%{transform:translateX(0%) translateY(-50%);}
				100%{transform:translateX(-100%) translateY(-50%);}
			}
  			.yan{
  				position:absolute;
  				border:0px;
  				color:white;
  				font-size:12px;
  				left:5px;
  				top:75%;
  				transform-origin:center center;
  				transform:rotate(-90deg) scale(0.8) translateX(60%);
  			}
  			.xin{
  				position:absolute;
  				border:0px;
  				color:red;
  				font-size:12px;
  				left:5px;
  				top:25%;
  				transform-origin:center center;
  				transform:rotate(-90deg) scale(0.8) translateX(60%);
  			}
  			.cover{
  				position:absolute;
  				border:0px;
  				background-color:#96b6b5;
  				width:25px;
  				height:20px;
  				bottom:2px;
  				left:0px;
  				transform-origin:bottom center;
  				transform:rotateX(90deg);
  				animation: covering 5s linear 0s forwards;
  			}
  			@keyframes covering
			{
				0%{transform-origin:bottom center;transform:rotateX(90deg);}
				80%{transform-origin:bottom center;transform:rotateX(90deg);}
				85%{transform-origin:bottom center;transform:rotateX(20deg);}
				95%{transform-origin:bottom center;transform:rotateX(-20deg);}
				100%{transform-origin:bottom center;transform:rotateX(-90deg);}
			}
			
			.pen{
  				position:absolute;
  				border:0px;
  				border-radius:2px 2px;
  				background-color:#aaa;
  				width:15px;
  				height:2px;
  				top:155px;
  				left:54px;
  				animation: pening 5s linear 0s forwards;
  			}
  			@keyframes pening
			{
				0%{transform-origin:bottom right;transform:rotate(0deg);}
				90%{transform-origin:bottom right;transform:rotate(0deg);}
				100%{transform-origin:bottom right;transform:rotate(120deg);}
			}
  			
  		 	.humancolor{
  		 		background-color:#e0bb95;
  		 	}
  		 	.tshirtcolor{
  		 		background-color:#f4a57e;
  		 	}
  		 	.pantscolor{
  		 		background-color:#2891d3;
  		 	}
  			.human{
  				position:absolute;
  				border:0px;
  				width:12px;
  				height:100px;
  				left:202px;
  				top:100px;
  				animation: humaning 5s linear 0s forwards;
  			}
  			@keyframes humaning
			{
				0%   {transform: translateX(0px)  translateY(0px);}
				
				10%   {transform: translateX(-20px) translateY(0px);}
				20%   {transform: translateX(-40px) translateY(-3px);}
				30%   {transform: translateX(-60px) translateY(0px);}
				40%   {transform: translateX(-80px) translateY(-3px);}
				50%   {transform: translateX(-100px) translateY(0px);}
				60%   {transform: translateX(-120px) translateY(-3px);}
				65%   {transform: translateX(-116px) translateY(1px);}
				70%   {transform: translateX(-113px) translateY(7px);}
				75%   {transform: translateX(-110px) translateY(20px);}
			
				100%   {transform: translateX(-110px) translateY(20px);}
			}
			.bodyupper{
  				position:absolute;
  				border:0px;
  				width:12px;
  				height:50px;
  				top:0px;
  				animation: bodyuppering 5s linear 0s forwards;
  			}
  			@keyframes bodyuppering
			{
				0%   {transform: translateX(0px) translateY(0px);}
				100%   {transform: translateX(0px) translateY(0px);}
			}
		  	.head{
  				position:absolute;
  				border-radius:12px 12px;
  				border:0px;
  				width:12px;
  				height:12px;
  				left:0px;
  				top:0px;
  				animation: heading 5s linear 0s forwards;
  			}
  			@keyframes heading
			{
				0%   {transform-origin:bottom center;transform: rotate(0deg);}
				
				90%   {transform-origin:bottom center;transform: rotate(0deg);}
				
				100%   {transform-origin:bottom center;transform: rotate(-30deg);}
			}
	
		  	.body{
  				position:absolute;
  				border-radius:8px 8px;
  				border:0px;
  				width:8px;
  				height:41px;
  				left:2px;
  				top:16px;
  				animation: bodying 5s linear 0s forwards;
  			}
  			@keyframes bodying
			{
				0%   {transform: translateX(0px) translateY(0px);}
				60%   {transform: translateX(0px) translateY(0px);}
				
				100%   {transform: translateX(0px) translateY(0px);}
			}

		  	.armleft{
  				position:absolute;
  				border:0px;
  				width:8px;
  				height:34px;
  				left:2px;
  				top:16px;
  				animation: armlefting 5s linear 0s forwards;
  			}
  			@keyframes armlefting
			{
				0%   {transform-origin:top center;transform: rotate(0deg);}
				
				10%   {transform-origin:4px 4px;transform: rotate(20deg);}
				30%   {transform-origin:4px 4px;transform: rotate(-20deg);}
				50%   {transform-origin:4px 4px;transform: rotate(20deg);}
				60%   {transform-origin:4px 4px;transform: rotate(0deg);}
				80%   {transform-origin:4px 4px;transform: rotate(40deg);}
				
				100%   {transform-origin:4px 4px;transform: rotate(40deg);}
			}

		  	.armleftupper{
  				position:absolute;
  				border-radius:8px 8px;
  				border:0px;
  				width:8px;
  				height:23px;
  				top:0px;
  				left:0px;
  				animation: armleftuppering 5s linear 0s forwards;
  			}
  			@keyframes armleftuppering
			{
				0%   {transform-origin:top center;transform: rotate(0deg);}
				
				100%   {transform-origin:top center;transform: rotate(0deg);}
			}

			.armleftlower{
  				position:absolute;
  				border-radius:8px 8px;
  				border:0px;
  				width:8px;
  				height:26px;
  				top:16px;
  				animation: armleftlowering 5s linear 0s forwards;
  			}
  			@keyframes armleftlowering
			{
				0%   {transform-origin:4px 4px;transform: rotate(0deg);}
				
				60%   {transform-origin:4px 4px;transform: rotate(0deg) scaleY(1);}
				65%   {transform-origin:4px 4px;transform: rotate(0deg) scaleY(0.4);}
				70%   {transform-origin:4px 4px;transform: rotate(50deg) scaleY(0.4);}
				80%   {transform-origin:4px 4px;transform: rotate(50deg) scaleY(0.8);}
				
				100%   {transform-origin:4px 4px;transform: rotate(50deg) scaleY(0.8);}
			}
			
			
		  	.armright{
  				position:absolute;
  				border:0px;
  				width:8px;
  				height:34px;
  				left:2px;
  				top:16px;
  				animation: armrighting 5s linear 0s forwards;
  			}
  			@keyframes armrighting
			{
				0%   {transform-origin:top center;transform: rotate(0deg);}
				
				10%   {transform-origin:4px 4px;transform: rotate(-20deg);}
				30%   {transform-origin:4px 4px;transform: rotate(20deg);}
				50%   {transform-origin:4px 4px;transform: rotate(-20deg);}
				60%   {transform-origin:4px 4px;transform: rotate(0deg);}
				80%   {transform-origin:4px 4px;transform: rotate(40deg);}
				100%   {transform-origin:4px 4px;transform: rotate(40deg);}
			}

		  	.armrightupper{
  				position:absolute;
  				border-radius:8px 8px;
  				border:0px;
  				width:8px;
  				height:23px;
  				top:0px;
  				left:0px;
  				animation: armrightuppering 5s linear 0s forwards;
  			}
  			@keyframes armrightuppering
			{
				0%   {transform-origin:top center;transform: rotate(0deg);}
				
				100%   {transform-origin:top center;transform: rotate(0deg);}
			}

			.armrightlower{
  				position:absolute;
  				border-radius:8px 8px;
  				border:0px;
  				width:8px;
  				height:26px;
  				top:16px;
  				animation: armrightlowering 5s linear 0s forwards;
  			}
  			@keyframes armrightlowering
			{
				0%   {transform-origin:4px 4px;transform: rotate(0deg);}
				60%   {transform-origin:4px 4px;transform: rotate(0deg) scaleY(1);}
				65%   {transform-origin:4px 4px;transform: rotate(0deg) scaleY(0.4);}
				70%   {transform-origin:4px 4px;transform: rotate(50deg) scaleY(0.4);}
				80%   {transform-origin:4px 4px;transform: rotate(50deg) scaleY(0.8);}
				
				100%   {transform-origin:4px 4px;transform: rotate(50deg) scaleY(0.8);}
			}
			
			.legleft{
  				position:absolute;
  				border:0px;
  				width:8px;
  				height:50px;
  				left:2px;
  				top:50px;
  				animation: leglefting 5s linear 0s forwards;
  			}

  			@keyframes leglefting
			{
				0%   {transform-origin:4px 4px;transform: rotate(0deg);}
				
				10%   {transform-origin:4px 4px;transform: rotate(-10deg);}
				30%   {transform-origin:4px 4px;transform: rotate(25deg);}
				50%   {transform-origin:4px 4px;transform: rotate(-10deg);}
				60%   {transform-origin:4px 4px;transform: rotate(0deg);}
				75%   {transform-origin:4px 4px;transform: rotate(90deg);}
				
				100%   {transform-origin:4px 4px;transform: rotate(90deg);}
			}
			.legleftupper{
  				position:absolute;
  				border-radius:8px 8px;
  				border:0px;
  				width:8px;
  				height:30px;
  				top:0px;
  				animation: legleftuppering 5s linear 0s forwards;
  			}
  			@keyframes legleftuppering
			{
				0%   {transform: translateX(0px) translateY(0px);}
				
				60%   {transform: translateX(0px) translateY(0px);}
								
				100%   {transform: translateX(0px) translateY(0px);}
			}
			
			.legleftlower{
  				position:absolute;
  				border-radius:8px 8px;
  				border:0px;
  				width:8px;
  				height:35px;
  				top:23px;
  				animation: legleftlowering 5s linear 0s forwards;
  			}
  			@keyframes legleftlowering
			{
				0%   {transform-origin:4px 4px;transform: rotate(0deg);}
				
				10%   {transform-origin:4px 4px;transform: rotate(-20deg);}
				20%   {transform-origin:4px 4px;transform: rotate(-40deg);}
				30%   {transform-origin:4px 4px;transform: rotate(-10deg);}
				40%   {transform-origin:4px 4px;transform: rotate(0deg);}
				50%   {transform-origin:4px 4px;transform: rotate(-20deg);}
				60%   {transform-origin:4px 4px;transform: rotate(0deg);}
				75%   {transform-origin:4px 4px;transform: rotate(-90deg);}
				
				100%   {transform-origin:4px 4px;transform: rotate(-90deg);}
			} 
			
			.legright{
  				position:absolute;
  				border:0px;
  				width:8px;
  				height:50px;
  				left:2px;
  				top:50px;
  				animation: legrighting 5s linear 0s forwards;
  			}

  			@keyframes legrighting
			{
				0%   {transform-origin:4px 4px;transform: rotate(0deg);}
				
				10%   {transform-origin:4px 4px;transform: rotate(25deg);}
				30%   {transform-origin:4px 4px;transform: rotate(-10deg);}
				50%   {transform-origin:4px 4px;transform: rotate(25deg);}
				60%   {transform-origin:4px 4px;transform: rotate(0deg);}
				75%   {transform-origin:4px 4px;transform: rotate(90deg);}
				
				100%   {transform-origin:4px 4px;transform: rotate(90deg);}
			}
			.legrightupper{
  				position:absolute;
  				border-radius:8px 8px;
  				border:0px;
  				width:8px;
  				height:30px;
  				top:0px;
  				animation: legrightuppering 5s linear 0s forwards;
  			}
  			@keyframes legrightuppering
			{
				0%   {transform: translateX(0px) translateY(0px);}
				
				60%   {transform: translateX(0px) translateY(0px);}
								
				100%   {transform: translateX(0px) translateY(0px);}
			}
			
			.legrightlower{
  				position:absolute;
  				border-radius:8px 8px;
  				border:0px;
  				width:8px;
  				height:35px;
  				top:23px;
  				animation: legrightlowering 5s linear 0s forwards;
  			}
  			@keyframes legrightlowering
			{
				0%   {transform-origin:4px 4px;transform: rotate(0deg);}
				
				10%   {transform-origin:4px 4px;transform: rotate(-10deg);}
				20%   {transform-origin:4px 4px;transform: rotate(0deg);}
				30%   {transform-origin:4px 4px;transform: rotate(-20deg);}
				40%   {transform-origin:4px 4px;transform: rotate(-40deg);}
				50%   {transform-origin:4px 4px;transform: rotate(-10deg);}
				60%   {transform-origin:4px 4px;transform: rotate(0deg);}
				75%   {transform-origin:4px 4px;transform: rotate(-90deg);}
				
				100%   {transform-origin:4px 4px;transform: rotate(-90deg);}
			}  		
		</style>
		<script src="jquery-3.3.1.min.js" ></script> 
		<script type="text/javascript">
		//var datainterface = "http://localhost:8080/yanxin/";
		//var photointerface = "http://localhost:8080/yanxin/";
		var datainterface = "/";
		var photointerface = "/";

		var msg_welcomlogin=" 欢迎回来";
		var msg_loginandexpired=" 你的账号已经过期，请及时延长过期时间，否则账号将被回收，回收后该账号的所有日记和相关数据都将无法找回";
		var msg_loginandexpiringstart=" 你的账号即将在 ";
		var msg_loginandexpiringend=" 后过期，请及时延长过期时间，否则账号将被回收，回收后该账号的所有日记和相关数据都将无法找回";
		
		var msg_passmodifysuccess="密码修改成功";
		var msg_cameranotsupport="你的浏览器不支持调取摄像头，请退出登录，然后用其它浏览器重新登录再试";
		var msg_camerareject="你已拒绝浏览器调取摄像头，如需拍照，请清除浏览器缓存然后刷新页面再试";
		var msg_startingautosaving="即将自动保存";
		var msg_journalsavesuccess="日记保存成功";
		var msg_journalsaving = "正在保存日记，保存成功之前请不要离开此页面";
		var msg_photosaving = "正在保存图片，保存成功之前请不要离开此页面";
		var msg_mottosavesuccess="格言修改成功";
		var msg_daystogiveadded="库存天数增加为 ";
		var msg_daystogiveremain="库存天数剩余 ";
		var msg_newexpire="过期时间延长为 ";
		var msg_timereused="回收时间 ";
		var msg_timeexpire="过期时间 ";
		var msg_daystogive="库存天数 ";
		var msg_extendhintstart="在 ";
		var msg_extendhintend=" 后可延长过期时间";
		var msg_newjournalhint="你今天还没写日记，开始写吧，每天可以保存一张图片，你所填写的内容会自动保存";
		var msg_photosavesuccess="图片保存成功";
		var msg_photosavefail="图片保存失败，";
		var msg_relogin="重新登录";
		var msg_uploadfail="网络异常或上传图片过大";
		var msg_networkfail="网络异常，请检查网络连接";
		var msg_uploadlimit="请选择小于100K的图片";
		var msg_snapuploadfail="拍照上传失败，请重新拍照或选择小于100K的图片上传";
		
		function post(context, actionid, paramjson, confirmtext){
			if (confirmtext!=null){
				if (!confirm(confirmtext)){
					loading(false);
					initactions();
					return;
				}
			}
			if (getcache("yanxinloginkey")!=null){
				paramjson.loginkey =getcache("yanxinloginkey");
			}
			
			var ajaxpost = $.ajax({
				url: datainterface+context+"/"+actionid,  
			　　	timeout : 10000, 
			　　	type : 'post',  
			　　	data :paramjson, 
			　　	success:function(result){
			　　		if (result.state=="success"){
						eval("after"+actionid+"(result.data)");
					} else {
						footmsg(result.error);
						loading(false);
						if (result.error.indexOf(msg_relogin)!=-1){
							setcache("yanxinloginkey", null);
							dologout();
						}
						if (result.error.indexOf("已过期")!=-1){
							doreadself();
						}
					}
			　　	},
			　　	complete : function(XMLHttpRequest,status){
			　　		if (this.url.indexOf("cexpired/write")!=-1){
			　　			setTimeout(autosavingtimer, 10000);
			　　		}
			　　		initactions();
			　　		if (status!="success"){
			　　			loading(false);
						ajaxpost.abort();
				　　		footmsg(msg_networkfail);
			　　		}
			　　	}
			});
		}

		function prepareupload(){
			$("#newfilebtn").hide();
			try{
				var reader  = new FileReader();
				reader.readAsDataURL($("#filebtn").prop("files")[0]);
				reader.onload = function () {
					try{
						var result = reader.result;
						if (result.length > 150000) {
					    		footmsg(msg_uploadlimit);
					    		$("#newfilebtn").fadeIn(500);
					    } else {
					    		var img = new Image();
					    		img.src = result;
					    		img.onload = function(){
								try{
									if (drawphotosmall(img, false)&&drawphoto(img, false)){
										uploadcanvas();
									} else {
										upload();
									}
								}catch(err){
									upload();
								}
							};
					    }
					}catch(err){
						upload();
					}
			  	};
			}catch(err){
				upload();
			}
		}
		
		function upload(){
			var paramdata = new FormData($("#dayimgwriteform")[0]);
			footmsg(msg_photosaving);
			var ajaxpost = $.ajax({
				url: datainterface+"cexpired/upload?loginkey="+getcache("yanxinloginkey"),  
			　　	timeout : 40000, 
			　　	type : 'post',  
			　　	data :paramdata, 
			　　	processData: false,
				contentType: false,
			　　	success:function(result){
			　　		if (result.state=="success"){
						eval("afterupload(result.data)");
					} else {
						footmsg(result.error);
						if (result.error.indexOf(msg_relogin)!=-1){
							setcache("yanxinloginkey", null);
							dologout();
						}
						if (result.error.indexOf("已过期")!=-1){
							doreadself();
						}
					}
				},
			　　	complete : function(XMLHttpRequest,status){
			　　		initactions();
			　　		if (status!="success"){
			　　			ajaxpost.abort();
				　　		footmsg(msg_uploadfail);
			　　		}
			　　	}
			});
		}

		function afterupload(data){
			var hint = "";
			if (data.newdaycomingminutes!=undefined){
				hint = "，"+data.newdaycomingminutes;
			}
			footmsg(msg_photosavesuccess+hint);
			$("#dayimgwrite").attr("src", "");
			$("#dayimgwrite").attr("src", photointerface+"freego/download?onetimekey="+data.onetimekeyphoto);
			$("#dayimgwrite").fadeIn(500);
			$("#imghint").hide();
		}

		function getcache(key){
			try{
				return localStorage.getItem(key);
			}catch(e){
				return sessionStorage.getItem(key);
			}
		}
		function setcache(key,value){
			try{
				if (value==undefined||value==null){
					sessionStorage.removeItem(key);
					localStorage.removeItem(key);
				} else {
					sessionStorage.setItem(key, value);
					localStorage.setItem(key, value);
				}
			}catch(e){
				//do nothing
			}
		}
		
		$(document).ready(function(){
			init();
			setTimeout(function(){
				$("#openingclosebtn").click();
			},5000);
		});
		
		function uploadcanvas(){
			footmsg(msg_photosaving);
			var canvasphoto = document.getElementById("photo");
			var canvasphotosmall = document.getElementById("photosmall");
			try{
				post("cexpired","uploadcanvas",{"photocanvasdataurl":canvasphoto.toDataURL("image/jpeg",0.6),
												"photosmallcanvasdataurl":canvasphotosmall.toDataURL("image/jpeg",1)});
			}catch(err){
				upload();
			}
		}
		function douploadcanvas(){
			footmsg(msg_photosaving);
			var video = document.getElementById('video');
			video.pause();
			if (drawphotosmall(video, true)&&drawphoto(video, true)){
				var canvasphoto = document.getElementById("photo");
				var canvasphotosmall = document.getElementById("photosmall");
				try{
					post("cexpired","uploadcanvas",{"photocanvasdataurl":canvasphoto.toDataURL("image/jpeg",0.6),
													"photosmallcanvasdataurl":canvasphotosmall.toDataURL("image/jpeg",1)});
				}catch(err){
					stopcam();
					$("#imghint").html(msg_snapuploadfail);
					$("#imghint").fadeIn(500);
				}
			} else {
				stopcam();
				$("#imghint").html(msg_snapuploadfail);
				$("#imghint").fadeIn(500);
			}
			
		}
		function afteruploadcanvas(data){
			stopcam();
			var hint = "";
			if (data.newdaycomingminutes!=undefined){
				hint = "，"+data.newdaycomingminutes;
			}
			if (data.compressed=="true"){
				footmsg(msg_photosavesuccess+hint);
				$("#dayimgwrite").attr("src","");
				$("#dayimgwrite").attr("src", photointerface+"freego/download?onetimekey="+data.onetimekeyphoto);
				$("#dayimgwrite").fadeIn(500);
				$("#imghint").hide();
				showupload();
			} else {
				footmsg(msg_photosavefail+data.reason);
				$("#imghint").show();
			}
		}
		
		function init(){
			initactions();
			$('#loginpass').bind('keyup', function(event) {
		        if (event.keyCode == "13") {
		            dologin();
		        }
		    });
			$('#loginmotto').bind('keyup', function(event) {
		        if (event.keyCode == "13") {
		        	 	dologin();
		        }
		    });
			if (getcache("yanxinloginkey")==null){
				$("#logoutbtn").click();
			} else {
				$("#todaybtn").click();
			}
			sessionStorage.setItem("isfootmsgtimerstarted","false");
			sessionStorage.setItem("isautosavingtimerstarted","false");
			startfootmsg();
			startautosaving();
		}
		
		function drawphotosmall(obj, isvideo) {
	        var width = obj.width;
	        var height = obj.height;
	        if (isvideo){
	        		width=obj.videoWidth;
	        		height=obj.videoHeight;
	        } 
	        var ratio = 1;
	        if (width>42||height>42){
	        		if (width>42){
	        			ratio = width/42;
	        		} else {
	        			ratio = height/42;
		        	}
	        }
	        try{
		        var canvas = document.getElementById("photosmall");
		        canvas.width = width/ratio;
		        canvas.height = height/ratio;
		       	var ctx = canvas.getContext('2d');
		        ctx.fillStyle = "#000";
		        ctx.fillRect(0, 0, canvas.width, canvas.height);
		        ctx.drawImage(obj, 0, 0, width/ratio, height/ratio);
		        return true;
			}catch(err){
				return false;
			}
	    }
		function drawphoto(obj, isvideo) {
	        var width = obj.width;
	        var height = obj.height;
	        if (isvideo){
	        		width=obj.videoWidth;
	        		height=obj.videoHeight;
	        	} 
	        if (width * height > 3000000){
	       		return false;
	       	} else {
	       		try{
			        var canvas = document.getElementById("photo");
			        canvas.width = width;
			        canvas.height = height;
			        var ctx = canvas.getContext('2d');
			        ctx.fillStyle = "#000";
			        ctx.fillRect(0, 0, canvas.width, canvas.height);
			        ctx.drawImage(obj, 0, 0, width, height);
			        return true;
				}catch(err){
					return false;
				}
	       	}
	    }
		
		function dologout(){
			if (getcache("yanxinloginkey")!=null){
				loading(true);
				post("creused","logout",{});
			}
			setcache("yanxinloginkey", null);
			if (getcache("yanxinname")!=null){
				$("#loginuser").val(getcache("yanxinname"));
			} else {
				$("#loginuser").val("");
			}
			$("#dayimgwrite").attr("src","");
			$("#contentwrite").val("");
			$("#contentwrite").attr("old","");
			$("#locationwrite").val("");
			$("#locationwrite").attr("old","");
			$("#weatherwrite").val("");
			$("#weatherwrite").attr("old","");
			$("#loginpass").val("");
			$("#loginmotto").val("");
			$(".hideallforms").hide();
			$(".hideallbtns").hide();
			$("#loginform").fadeIn(500);
			$("#newuserbtn").show();
		}
		
		function afterlogout(data){
			footmsg("");
			sessionStorage.removeItem("iswriting");
			loading(false);
		}
		
		function dologin(){
			loading(true);
			post("freego","login",{"name":$("#loginuser").val(),"pass":$("#loginpass").val(),"motto":$("#loginmotto").val()});
		}
		function afterlogin(data){
			$("#filebtn").val("");
			setcache("yanxinloginkey",data.loginkey);
			$("#extendselfbtn").attr("targetname",data.name);
			setcache("yanxinname",data.name);
			$(".hideallforms").hide();
			$(".hideallbtns").hide();
			$("#todaybtn").val(data.today);
			$("#todaybtn").show();
			$("#accountbtn").show();
			$("#calendarbtn").show();
			if (data.isexpired=="t"){
				$("#accountbtn").click();
				footmsg(data.name+msg_welcomlogin+msg_loginandexpired);
			} else {
				if (data.expiretime!=undefined){
					footmsg(data.name+msg_welcomlogin+msg_loginandexpiringstart+data.expiretime+msg_loginandexpiringend);
					$("#accountbtn").click();
				} else {
					footmsg(data.name+msg_welcomlogin);
					$("#todaybtn").click();
				}
			}
		}
		
		function showregisterform(){
			$(".hideallforms").hide();
			$(".hideallbtns").hide();
			$("#registerform").show();
			$("#existuserbtn").show();
		}
		function showloginform(){
			$(".hideallforms").hide();
			$(".hideallbtns").hide();
			$("#loginform").show();
			$("#newuserbtn").show();
		}
		
		function doregister(){
			loading(true);
			post("freego","register",{"name":$("#registeruser").val(),"pass":$("#registerpass").val(),"repass":$("#registerrepass").val(),"motto":$("#registermotto").val(),"remotto":$("#registerremotto").val()});
		}
		function afterregister(data){
			setcache("yanxinname",$("#registeruser").val());
			$("#registeruser").val("");
			$("#registerpass").val("");
			$("#registerrepass").val("");
			$("#registermotto").val("");
			$("#registerremotto").val("");
			footmsg(data);
			post("freego","agreement",{});
			dologout();
		}
		
		function afteragreement(data){
			var content="<div style='text-align:center;'><b>"+data.title+"</b></div>";
			for (var i=0;i<data.items.length;i++){
				if (i==data.items.length-1){
					content+="<b>"+data.items[i]+"</b>";
				} else {
					content+=data.items[i]+"<br>";
				}
			}
			content+="<br>&nbsp;";
			popmsg(content);
			loading(false);
		}
		function afterforgetpass(data){
			popmsg(data);
		}
		function afterbuyhint(data){
			popmsg(data);
		}
		
		function doreadself(){
			loading(true);
			$(".hideallforms").hide();
			$("#changepass").val("");
			$("#changerepass").val("");
			$("#changemotto").val("");
			$("#changeremotto").val("");
			$("#selfname").html("");
			$("#selfextendbtn").attr("extendname", "");
			$("#selfexpiretime").html("");
			$("#selfreusetime").html("");
			$("#selfdaystogive").html("");
			$("#selfextendhint").html("");
			$(".hideallaccountform").hide();
			$(".hideallotheraccountform").hide();
			post("creused","readself",{});
		}
		function afterreadself(data){
			$("#accountform").fadeIn(500, function(){loading(false);});
			$("#selfname").html(data.name);
			$("#todaybtn").val(data.today);
			$("#selfextendbtn").attr("extendname", data.name);
			$("#selfexpiretime").html(msg_timeexpire+data.timeexpire);
			$("#selfreusetime").html(msg_timereused+data.timereuse);
			if (parseInt(data.daystogive)>0){
				$("#selfdaystogive").html(msg_daystogive+data.daystogive);
				$("#daystogivespendform").show();
				$("#selfdaystogive").show();
			}
			
			if (data.extendselfaftertime!=undefined){
				$("#selfextendhint").html(msg_extendhintstart+data.extendselfaftertime+msg_extendhintend);
				$("#selfextendhint").show();
			} else {
				if (parseInt(data.daystogive)>0){
					$("#selfextendform").show();
				} else {
					$("#extendbtn").show();
				}
			}
		}
		
		function docalendar(){
			loading(true);
			$(".hideallforms").hide();
			$("#calendarform").children().remove();
			post("cexpired","calendar",{"year":$(this).attr("year"),"month":$(this).attr("month")});
		}
		function aftercalendar(data){
			$("#calendarform").fadeIn(500, function(){loading(false);});
			$("#calendarform").append("<div id='calendaryear' style='width:100%;float:left;margin-bottom:5px;'></div>");
			if (data.leftyear!=undefined){
				$("#calendaryear").append("<div style='float:left;width:33%;text-align:center;'><input onclick='navigateyearmonth(\"year\", \""+data.leftyear+"\")' type='button' value='"+data.leftyear+"年'/></div>");
			} else {
				$("#calendaryear").append("<div style='float:left;width:33%;'>&nbsp;</div>");
			}
			$("#calendaryear").append("<div style='float:left;width:33%;text-align:center;'>"+data.middleyear+"年</div>");
			if (data.rightyear!=undefined){
				$("#calendaryear").append("<div style='float:left;width:33%;text-align:center;'><input onclick='navigateyearmonth(\"year\", \""+data.rightyear+"\")' type='button' value='"+data.rightyear+"年'/></div>");
			} else {
				$("#calendaryear").append("<div style='float:left;width:33%;'>&nbsp;</div>");
			}
			
			$("#calendarform").append("<div style='width:98vw;float:left;'>"+
					"<div style='width:14vw;float:left;text-align:center;'>周日</div>"+
					"<div style='width:14vw;float:left;text-align:center;'>周一</div>"+
					"<div style='width:14vw;float:left;text-align:center;'>周二</div>"+
					"<div style='width:14vw;float:left;text-align:center;'>周三</div>"+
					"<div style='width:14vw;float:left;text-align:center;'>周四</div>"+
					"<div style='width:14vw;float:left;text-align:center;'>周五</div>"+
					"<div style='width:14vw;float:left;text-align:center;'>周六</div>"+
					"</div>");
			for (var i=0;i<data.onemonth.length;i++){
				$("#calendarform").append("<div id='calendarweek"+i+"' style='width:98vw;float:left;'></div>");
				for (var j=0;j<data.onemonth[i].length;j++){
					if (data.onemonth[i][j].monthday!=undefined){
						if (data.onemonth[i][j].key!=undefined){
							var bg = "";
							if (data.onemonth[i][j].onetimekeyphoto!=undefined){
								bg="background-image: url("+photointerface+"freego/download?which=small&onetimekey="+data.onemonth[i][j].onetimekeyphoto+");background-size:contain;background-repeat:no-repeat;";
							}
							var actionid="actionid='readyanxin'";
							if (data.onemonth[i][j].istoday=="true"){
								actionid="onclick=\"$('#todaybtn').click()\"";
							}
							$("#calendarweek"+i).append("<div "+actionid+" yanxinkey='"+data.onemonth[i][j].key+"' style='"+bg+"float:left;text-align:center;width:14vw;height:14vw;' class='click'><div style='background-color:black;float:right;border-radius:50%;opacity:0.6;padding-top:2px;padding-left:1px;padding-right:1px;'>"+data.onemonth[i][j].monthday+"</div></div>");
						} else {
							$("#calendarweek"+i).append("<div style='float:left;text-align:center;width:14vw;height:14vw;' >"+data.onemonth[i][j].monthday+"</div>");
						}
					} else {
						$("#calendarweek"+i).append("<div style='float:left;width:14vw;height:14vw;'>&nbsp;</div>");
					}
				}
			}
			
			$("#calendarform").append("<div id='calendarmonth' style='width:100%;float:left;margin-top:5px;margin-bottom:5px;'></div>");
			if (data.leftmonth!=undefined){
				$("#calendarmonth").append("<div style='float:left;width:33%;text-align:center;'><input onclick='navigateyearmonth(\"month\", \""+data.leftmonth+"\")' type='button' value='"+data.leftmonth+"月'/></div>");
			} else {
				$("#calendarmonth").append("<div style='float:left;width:33%;'>&nbsp;</div>");
			}
			$("#calendarmonth").append("<div style='float:left;width:33%;text-align:center;'>"+data.middlemonth+"月</div>");
			if (data.rightmonth!=undefined){
				$("#calendarmonth").append("<div style='float:left;width:33%;text-align:center;'><input onclick='navigateyearmonth(\"month\", \""+data.rightmonth+"\")' type='button' value='"+data.rightmonth+"月'/></div>");
			} else {
				$("#calendarmonth").append("<div style='float:left;width:33%;'>&nbsp;</div>");
			}
			
			initactions();
		}
		
		function navigateyearmonth(yearormonth, value){
			$("#calendarbtn").attr(yearormonth, value);
			$("#calendarbtn").click();
		}
		
		function doreadyanxin(){
			loading(true);
			$(".hideallforms").hide();
			post("cexpired","readyanxin",{"yanxinkey":$(this).attr("yanxinkey")});
		}
		function afterreadyanxin(data){
			$("#dayread").html(data.day);
			$("#calendarbtn").attr("year",data.day.split("-")[0]);
			$("#calendarbtn").attr("month",data.day.split("-")[1]);
			$("#weatherread").html(data.weather);
			$("#locationread").html(data.location);
			$("#contentread").val(data.content);
			$("#dayimgread").attr("src","");
			if (data.onetimekeyphoto!=undefined){
				$("#dayimgread").attr("src",photointerface+"freego/download?onetimekey="+data.onetimekeyphoto);
			}
			$("#yanxinreadform").fadeIn(500, function(){loading(false);});
		}
		
		function doreadtoday(){
			loading(true);
			$(".hideallforms").hide();
			$("#dayimgwrite").attr("src","");
			$("#contentwrite").val("");
			$("#contentwrite").attr("old","");
			$("#locationwrite").val("");
			$("#locationwrite").attr("old","");
			$("#weatherwrite").val("");
			$("#weatherwrite").attr("old","");
			post("cexpired","readtoday",{});
		}
		
		function afterreadtoday(data){
			sessionStorage.setItem("iswriting", "true");
			$("#todaybtn").show();
			$("#accountbtn").show();
			$("#calendarbtn").show();
			$("#calendarbtn").attr("year",data.today.split("-")[0]);
			$("#calendarbtn").attr("month",data.today.split("-")[1]);
			$("#todaybtn").val(data.today);
			$("#yanxinwriteform").fadeIn(500, function(){loading(false);});
			$("#daywrite").html(data.today);
			if (data.key==undefined){
				$("#imghint").show();
				footmsg(msg_newjournalhint);
			} else {
				if (data.onetimekeyphoto!=undefined){
					$("#dayimgwrite").attr("src","");
					$("#dayimgwrite").attr("src",photointerface+"freego/download?onetimekey="+data.onetimekeyphoto);
					$("#imghint").hide();
				} else {
					$("#imghint").show();
				}
				$("#contentwrite").val(data.content);
				$("#contentwrite").attr("old",data.content);
				
				$("#locationwrite").val(data.location);
				$("#locationwrite").attr("old",data.location);

				$("#weatherwrite").val(data.weather);
				$("#weatherwrite").attr("old",data.weather);
			}
		}
		
		function doreadother(){
			loading(true);
			$(".hideallotheraccountform").hide();
			$("#otherreusetime").html("");
			$("#otherexpiretime").html("");
			$("#otherdaystogive").html("");
			$("#othergivebtn").attr("givename","");
			$("#otherextendbtn").attr("extendname","");
			$("#otherextendhint").html("");
			$("#otherextend").val("");
			$("#othergive").val("");
			post("cexpired","readother",{"targetname":$("#findother").val()});
		}
		
		function afterreadother(data){
			loading(false);
			$("#otherreusetime").html(msg_timereused+data.timereuse);
			$("#otherexpiretime").html(msg_timeexpire+data.timeexpire);
			$("#otherdaystogive").html(msg_daystogive+data.daystogive);
			$("#othergivebtn").attr("givename",data.name);
			$("#otherextendbtn").attr("extendname",data.name);
			$("#othergive").show();
			$("#othergivebtn").show();
			$("#otherextendform").show();
			if (data.extendotheraftertime!=undefined){
				$("#otherextendhint").html(msg_extendhintstart+data.extendotheraftertime+msg_extendhintend);
				$("#otherextendhint").show();
				$("#otherextend").hide();
				$("#otherextendbtn").hide();
			} else {
				$("#otherextend").show();
				$("#otherextendbtn").show();
			}
		}

		function dochangepass(){
			loading(true);
			post("creused","changepass",{"pass":$("#changepass").val(),"repass":$("#changerepass").val()});
		}
		function afterchangepass(data){
			$("#changepass").val("");
			$("#changerepass").val("");
			footmsg(msg_passmodifysuccess);
			loading(false);
		}

		function doextend(){
			try{
				var toextenddays = parseInt($("#"+$(this).attr("selforother")+"extend").val());
				if (toextenddays>0){
					loading(true);
					post("creused","extend",{"incre":$("#"+$(this).attr("selforother")+"extend").val(),"targetname":$(this).attr("extendname")},
							"确定将过期时间延长"+$("#"+$(this).attr("selforother")+"extend").val()+"天吗？延长后不可撤销");
				} else {
					initactions();
				}
			}catch(err){
				initactions();
			}
		}
		function afterextend(data){
			loading(false);
			$("#"+data.selforother+"extend").val("");
			$("#selfdaystogivenew").html(msg_daystogiveremain+data.daystogive);
			$("#selfdaystogivenew").show();
			$("#"+data.selforother+"expiretimenew").html(msg_newexpire+data.timeexpire);
			$("#"+data.selforother+"expiretimenew").show();
			$("#"+data.selforother+"reusetime").html(msg_timereused+data.timereuse);
			if (parseInt(data.daystogive)<=0){
				$("#daystogivespendform").hide();
				$("#selfextendform").hide();
			}
		}
		
		function dogive(){
			try{
				var togivedays = parseInt($("#othergive").val());
				if (togivedays>0){
					loading(true);
					post("cexpired","give",{"incre":$("#othergive").val(),"targetname":$(this).attr("givename")},
							"确定将库存天数增加"+$("#othergive").val()+"天吗？增加后不可撤销");
				} else{
					initactions();
				}
			}catch(err){
				initactions();
			}
		}
		function aftergive(data){
			loading(false);
			$("#othergive").val("");
			$("#otherdaystogivenew").html(msg_daystogiveadded+data.otherdaystogive);
			$("#otherdaystogivenew").show();
			$("#selfdaystogivenew").html(msg_daystogiveremain+data.daystogive);
			$("#selfdaystogivenew").show();
			if (parseInt(data.daystogive)<=0){
				$("#daystogivespendform").hide();
				$("#selfextendform").hide();
			}
		}

		function dochangemotto(){
			loading(true);
			post("creused","changemotto",{"motto":$("#changemotto").val(),"remotto":$("#changeremotto").val()});
		}
		function afterchangemotto(data){
			$("#changemotto").val("");
			$("#changeremotto").val("");
			footmsg(msg_mottosavesuccess);
			loading(false);
		}

		function initactions(){
			$(".click").each(function(){
				if ($(this).attr("actionid")!=undefined){
					$(this).unbind("click");
					$(this).one("click",eval("do"+$(this).attr("actionid")));
				}
			});
			$("#newfilebtn").show();
			stopcam();
		}
		function loading(show){
			$(".hideloading").remove();
			if (show){
				$(".divroot").append("<div id='loadingform' class='hideloading' style='position:absolute;top:0px;left:0px;right:0px;bottom:54px;background-color:black;opacity:0.7;z-index:10000;'>"+
				"<div class='load' style='position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%);'>请稍后......</div>"+
				"</div>");
			}
		}
		function popmsg(content){
			$(".hidemsgpop").remove();
			$(".divroot").append("<div id='msgpopform' class='hidemsgpop' style='position:absolute;display:none;top:0px;left:0px;right:0px;bottom:54px;background-color:black;opacity:0.8'></div>");
			$("#msgpopform").fadeIn(500);
			$(".divroot").append("<div class='msgpop hidemsgpop'>"+content+"</div>");
			$(".divroot").append("<div id='msgpopbtn' class='hidemsgpop' style='display:none;position:absolute;bottom:58px;right:0px;left:0px;height:30px;text-align:center;'><input onclick=\"$('.hidemsgpop').remove();\" type='button' value='知道了'/></div>");
			$("#msgpopbtn").fadeIn(500);
		}
		
		function startautosaving(){
			if (sessionStorage.getItem("isautosavingtimerstarted")=="true"){
				return;
			}
			sessionStorage.setItem("isautosavingtimerstarted","true");
			setTimeout(autosavingtimer, 10000);
		}
		
		function autosavingtimer(){
			if ($("#contentwrite").val()!=$("#contentwrite").attr("old")||
					$("#locationwrite").val()!=$("#locationwrite").attr("old")||
					$("#weatherwrite").val()!=$("#weatherwrite").attr("old")){
				footmsg(msg_journalsaving);
				post("cexpired","write",{"weather":$("#weatherwrite").val(),"location":$("#locationwrite").val(),"content":$("#contentwrite").val()});
			} else {
				setTimeout(autosavingtimer, 10000);
			}
		}
		
		function afterwrite(data){
			var hint = "";
			if (data.newdaycomingminutes!=undefined){
				hint = "，"+data.newdaycomingminutes;
			}
			$("#contentwrite").attr("old",data.content);
			$("#locationwrite").attr("old",data.location);
			$("#weatherwrite").attr("old",data.weather);
			footmsg(msg_journalsavesuccess+hint);
		}
		
		var footmsgs = new Array();
		function startfootmsg(){
			if (sessionStorage.getItem("isfootmsgtimerstarted")=="true"){
				return;
			}
			sessionStorage.setItem("isfootmsgtimerstarted","true");
			setTimeout(footmsgtimer, 1500);
		}
		function footmsgtimer(){
			if (footmsgs.length>0){
				if ($(".msgfoot").is(":visible")&&footmsgs[0]==$(".msgfoot").html()){
					footmsgs.splice(0, 1);
				} else {
					$(".msgfoot").remove();
					$(".divsecondbottom").append("<div class='msgfoot'>"+footmsgs[0]+
						"</div>");
					footmsgs.splice(0, 1);
				}
			}
			setTimeout(footmsgtimer, 1500);
		}
		function footmsg(content){
			try{
				if (footmsgs[footmsgs.length-1]!=content){
					footmsgs.push( content );
				}
			}catch(err){
				footmsgs.push( content );
			}
		}

		function checkinput(id){
			if ($("#"+id).attr("old")!=$("#"+id).val()){
				footmsg(msg_startingautosaving);
			}
		}
		function showupload(){
			$("#newfilebtn").show();
			$("#dayimgwrite").show();
			stopcam();
			$("#toggle").animate({"left":"0%"},500);
		}
		function showfrontcam(){
			showcam(false);
			$("#dayimgwrite").hide();
			$("#newfilebtn").hide();
			$("#toggle").animate({"left":"33%"},500);
		}
		function showbackcam(){
			showcam(true);
			$("#dayimgwrite").hide();
			$("#newfilebtn").hide();
			$("#toggle").animate({"left":"66%"},500);
		}

		function stopcam(){
			$("#video").hide();
			$("#snap").hide();
			$("#imghint").html("");
			$("#imghint").hide();
			var video = document.getElementById('video');
			try{
				stream = video.srcObject;
				tracks = stream.getTracks();
				tracks.forEach(function(track) {
				   track.stop();
				});
			}catch(err){
			 	//do nothing
			}
			try{
				video.srcObject=null;
			}catch(err){
				//do nothing
			}
		}
		function showcam(isrear){
			try{
				stopcam();
				if (navigator.mediaDevices === undefined) {
					navigator.mediaDevices = {};
				}
				if (navigator.mediaDevices.getUserMedia === undefined) {
					navigator.mediaDevices.getUserMedia = function(constr) {
					   	var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
					    if (!getUserMedia) {
					    		return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
					    }
					    return new Promise(function(resolve, reject) {
					      	getUserMedia.call(navigator, constr, resolve, reject);
					    });
				  	}
				}
				var facingmode = "user";
				if (isrear){
					facingmode = "environment";
				}
				var constraints = { audio: false, video: { facingMode: facingmode, width: 400, height: 400 } };
				navigator.mediaDevices.getUserMedia(constraints).then(function(stream) {
					var video = document.querySelector('video');
					if ("srcObject" in video) {
					 	video.srcObject = stream;
					} else {
					    video.src = window.URL.createObjectURL(stream);
					}
					video.onloadedmetadata = function(e) {
					 	video.play();
					 	$("#dayimgwrite").hide();
					 	$("#video").fadeIn(500);
					 	$("#snap").fadeIn(500);
					};
				}).catch(function(err) {
					stopcam();
					if ((err+"").indexOf("NotAllowedError")!=-1){
						$("#imghint").html(msg_camerareject);
						$("#imghint").fadeIn(500);
					} else {
						$("#imghint").html(msg_cameranotsupport);
						$("#imghint").fadeIn(500);
					}
				});
			}catch(err){
				stopcam();
				$("#imghint").html(msg_cameranotsupport);
				$("#imghint").fadeIn(500);
			}
		}
		</script>
	</head>
	<body>
	<div class="divroot">
		<div class="divsecondtop">
			<div id="yanxinwriteform" class="hideallforms" style="position:absolute;display:none;top:0px;left:0px;right:0px;bottom:0px;">
				<div class="yximgwrite">
					<div id="imghint" style="position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%);width:80%;text-align:left;"></div>
					<video id="video" style="position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%);display:none;" autoplay></video>
					<canvas id="photo" style="position:absolute;display:none;"></canvas>
					<canvas id="photosmall" style="position:absolute;display:none;"></canvas>
					<img id="dayimgwrite" src="" style="position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%);max-width: 100%;max-height: 100%;"/>
					
					<form method="POST" enctype="multipart/form-data" id="dayimgwriteform">
						<input id="filebtn" name="photo" accept="image/*" onchange="prepareupload();" style="display:none;" type="file"/>
					</form>
					<input type="button" id="snap" actionid="uploadcanvas" class="click" style="position:absolute;bottom:40px;left:50%;transform:translateX(-50%);display:none;" value="拍照上传"/>
					<input type="button" id="newfilebtn" onclick="$('#filebtn').click()" style="position:absolute;bottom:40px;left:50%;transform:translateX(-50%);display:none;" value="选择小于100K的图片上传"/>
					
					<div style="position:absolute;right:0px;left:0px;height:40px;bottom:0px;background-color:#000;opacity:0.6;"></div>
					<div id="toggle" style="position:absolute;width:calc(33% - 2px);height:30px;left:0%;border-radius:4px;bottom:3px;border:1px #eee solid;">&nbsp;</div>
					<div onclick="showupload()" style="position:absolute;width:33%;left:0%;height:30px;bottom:4px;text-align:center;">图片</div>
					<div onclick="showfrontcam()" style="position:absolute;width:33%;left:33%;height:30px;bottom:4px;text-align:center;">前摄</div>
					<div onclick="showbackcam()" style="position:absolute;width:33%;left:66%;height:30px;bottom:4px;text-align:center;">后摄</div>
					
				</div>
				<div class="yxinputswrite">
					<div id="daywrite" style="position:absolute;line-height:30px;height:30px;width:110px;top:4px;left:0px;overflow:hidden;"></div>
					<div style="position:absolute;line-height:30px;height:30px;width:calc(100% - 110px);top:4px;left:110px;">
						<input id="weatherwrite" old="" oninput="checkinput('weatherwrite')" style="width:calc(40% - 4px);" type="text" maxlength="10" placeholder="填写天气"/>
						<input id="locationwrite" old="" oninput="checkinput('locationwrite')" style="width:calc(60% - 2px);" type="text" maxlength="20" placeholder="填写地点"/>
					</div>
					<textarea id="contentwrite" old="" oninput="checkinput('contentwrite')" style="position:absolute;top:38px;left:0px;height:calc(100% - 38px);width:100%;resize:none;" maxlength="1000" placeholder="填写日记，限1000字"></textarea>
				</div>
			</div>
			<div id="yanxinreadform" class="hideallforms" style="position:absolute;display:none;top:0px;left:0px;right:0px;bottom:0px;overflow:hidden;text-align:left;">
				<div class="yximgread">
					<img id="dayimgread" src="" style="position:absolute;top:50%;left:50%;transform:translateX(-50%) translateY(-50%);max-width: 100%;max-height: 100%;"/>
				</div>
				<div class="yxinputsread">
					<div id="dayread" style="position:absolute;top:0px;left:4px;height:30px;line-height:30px;right:120px;"></div>
					<div id="weatherread" style="position:absolute;top:0px;left:124px;height:30px;line-height:30px;right:0px;"></div>
					<div id="locationread"style="position:absolute;top:30px;left:4px;height:30px;line-height:30px;right:0px;"></div>
					<textarea id="contentread" disabled style="position:absolute;background-color:#000;color:#ddd;top:60px;left:0px;right:0px;bottom:0px;height:calc(100% - 60px);width:100%;resize:none;">
					</textarea>
				</div>
			</div>
			<div id="loginform" class="hideallforms" style="position:absolute;display:none;top:50%;transform:translateY(-50%);left:0px;right:0px;text-align:center;">
				<div style="position:absolute;font-size:12px;bottom: 100%;left: 50%;transform: translateX(4vh);">™️️</div>
				<img src="logo.png" style="width:8vh;height:8vh;">
				<div style="margin:2px;">登录你的言心日记</div>
				<input id="loginuser" style="margin:2px;" size="20" type="text" maxlength="20" placeholder="填写账号"/><br>
				<input id="loginpass" style="margin:2px;" size="20" type="password" maxlength="20" placeholder="只填写密码即可登录"/><br>
				<input id="loginmotto" style="margin:2px;" size="20" type="text" maxlength="100" placeholder="或只填写格言也可登录"/><br>
				<div style="position:absolute;top:100%;font-size:16px;color:#f4a57e;right:50%;transform:translateX(-40px)" 
				onclick="post('freego','forgetpass',{})">忘记密码?</div>
				<input actionid="login" class="click" type="button" style="margin:2px;" value="登录"/>
			</div>
			<div id="registerform" class="hideallforms" style="position:absolute;display:none;top:50%;transform:translateY(-50%);left:0px;right:0px;text-align:center;">
				<div style="position:absolute;font-size:12px;bottom: 100%;left: 50%;transform: translateX(4vh);">™️</div>
				<img src="logo.png" style="width:8vh;height:8vh;">
				<div style="margin:2px;">注册你的言心账号</div>
				<input id="registeruser" style="margin:2px;" size="20" type="text" maxlength="20" placeholder="填写账号，可写中文"/><br>
				<input id="registerpass" style="margin:2px;" size="20" type="password" maxlength="20" placeholder="填写密码，可写中文"/><br>
				<input id="registerrepass" style="margin:2px;" size="20" type="password" maxlength="20" placeholder="重复一次密码"/><br>
				<input id="registermotto" style="margin:2px;" size="20" type="text" maxlength="100" placeholder="填写格言，可写中文"/><br>
				<input id="registerremotto" style="margin:2px;" size="20" type="text" maxlength="100" placeholder="重复一次格言"/><br>
				<div style="position:absolute;top:100%;font-size:16px;color:#f4a57e;right:50%;transform:translateX(-40px)" 
				onclick="post('freego','agreement',{})">你的言心协议</div>
				<input actionid="register" class="click" type="button" style="margin:2px;" value="注册"/>
			</div>
			<div id="accountform" class="hideallforms" style="position:absolute;display:none;max-height:100%;left:0px;right:0px;bottom:0px;overflow-x:hidden;overflow-y:auto;text-align:center;">
					<div id="selfname" style="margin:2px;width:100%;text-align:center;"></div>
					<div style="margin:2px;width:100%;text-align:center;"><font onclick="post('freego','agreement',{})" style="margin:2px;color:#f4a57e;">你的言心协议</font><input id="logoutbtn" actionid="logout" class="click" type="button" value="退出登录"/></div>
					<div style="width:100%;margin:2px;"><font id="selfreusetime"></font></div>
					<div style="width:100%;margin:2px;"><font id="selfexpiretime"></font> <br> <input id="extendbtn" onclick="post('freego','buyhint',{})" type="button" class="hideallaccountform" style="display:none;margin:2px;" value="延长过期时间"/></div>
					<div id="selfexpiretimenew" class="hideallaccountform" style="width:100%;margin:2px;display:none;color:#f4a57e;"></div>
					<div id="selfextendhint" class="hideallaccountform" style="width:100%;margin:2px;display:none;color:#f4a57e;"></div>
					<div id="selfdaystogive" class="hideallaccountform" style="display:none;margin:2px;width:100%;"></div>
					<div id="selfdaystogivenew" class="hideallaccountform" style="display:none;margin:2px;width:100%;color:#f4a57e;"></div>
					<div id="selfextendform" class="hideallaccountform" style="display:none;margin:2px;width:100%;"><input id="selfextend" style="margin:2px;" size="5" type="text" maxlength="5" placeholder="填写天数"/><input id="selfextendbtn" actionid="extend" class="click" type="button" style="margin:2px;" selforother="self" value="延长自己的过期时间"/></div>

					<div id="daystogivespendform" class="hideallaccountform" style="display:none;padding:5px;margin:5px;text-align:center;border:1px #eee solid;border-radius:4px;">
						<div style="width:100%;"><input id="findother" style="margin:2px;" size="10" type="text" maxlength="20" placeholder="填写其它账号"/><input id="findotherbtn" actionid="readother" class="click" style="margin:2px;" type="button" value="查询"/></div>
						<div id="otherextendform" class="hideallotheraccountform" style="display:none;width:100%;">
							<div id="otherreusetime" style="margin:2px;width:100%;"></div>
							<div id="otherexpiretime" style="margin:2px;width:100%;"></div>
							<div id="otherexpiretimenew" class="hideallotheraccountform" style="margin:2px;width:100%;display:none;color:#f4a57e;"></div>
							<div id="otherextendhint" class="hideallotheraccountform" style="width:100%;margin:2px;display:none;color:#f4a57e;"></div>
							<div style="width:100%;"><input id="otherextend" class="hideallotheraccountform" style="margin:2px;display:none;" size="5" type="text" maxlength="5" placeholder="填写天数"/><input actionid="extend" class="click" id="otherextendbtn" class="hideallotheraccountform" style="display:none;margin:2px;" selforother="other" type="button" value="延长过期时间"/></div>
							<div id="otherdaystogive" style="margin:2px;width:100%;"></div>
							<div id="otherdaystogivenew" class="hideallotheraccountform" style="margin:2px;width:100%;display:none;color:#f4a57e;"></div>
							<div style="width:100%;"><input id="othergive" class="hideallotheraccountform" style="margin:2px;" size="5" type="text" maxlength="5" placeholder="填写天数"/><input id="othergivebtn" class="hideallotheraccountform click" actionid="give" type="button" style="margin:2px;" value="增加库存天数"/></div>
						</div>
					</div>
					
					<div style="width:100%;"><input id="changepass" style="margin:2px;" size="20" type="password" maxlength="20" placeholder="填写新密码"/><br>
					<input id="changerepass" style="margin:2px;" size="20" type="password" maxlength="20" placeholder="重复一次新密码"/><br>
					<input actionid="changepass" class="click" type="button" style="margin:2px;" value="修改密码"/></div>
					<div style="width:100%;"><input id="changemotto" style="margin:2px;" size="20" type="text" maxlength="100" placeholder="填写新格言"/><br>
					<input id="changeremotto" style="margin:2px;" size="20" type="text" maxlength="100" placeholder="重复一次新格言"/><br>
					<input actionid="changemotto" class="click" type="button" style="margin:2px;" value="修改格言"/></div>
			</div>
			<div id="calendarform" class="hideallforms" style="position:absolute;display:none;max-height:100%;left:0px;right:0px;bottom:0px;overflow-x:hidden;overflow-y:auto;">
			</div>
		</div>
		<div class="divsecondbottom">
			<div style="position:absolute;top:0px;left:50%;transform:translateX(-50%);width:400px;text-align:center;margin:4px;">
				<input id="accountbtn" actionid="readself" class="hideallbtns click" type="button" style="display:none;background-image: url(logo.png);background-size:contain;background-repeat:no-repeat;padding-left:34px;background-color:black;border-radius:unset;" value="账号"/>
				<input id="calendarbtn" actionid="calendar" class="hideallbtns click" type="button" style="display:none;" value="日历"/>
				<input id="todaybtn" actionid="readtoday" class="hideallbtns click" type="button" style="display:none;" value="今天"/>
				<input id="newuserbtn" onclick="showregisterform()" class="hideallbtns" type="button" style="display:none;" value="注册新账号"/>
				<input id="existuserbtn" onclick="showloginform()" class="hideallbtns" type="button" style="display:none;" value="已有账号"/>
			</div>
		</div>
		<div class="openingclose" style="position:absolute;top:0px;left:0px;right:0px;bottom:54px;background-color:black;"></div>
		<div class="opening openingclose">
			<input id="openingclosebtn" style="position:absolute;left:25%;bottom:0px;transform:translateX(-50%)" type="button" value="跳过" onclick="$('.openingclose').fadeOut(1000);"/>
			<div style="position:absolute;top:178px;left:87px;">
				<div style="position:absolute;border:0px;border-radius:4px 4px;background-color:#ddd;width:20px;height:4px;"></div>
				<div style="position:absolute;border:0px;background-color:#ddd;width:4px;height:23px;left:2px;top:4px;"></div>
				<div style="position:absolute;border:0px;background-color:#ddd;width:4px;height:23px;left:14px;top:4px;"></div>
			</div>

			<div class="human">
				<div class="head humancolor"></div>
				<div class="armleft">
					<div class="armleftupper tshirtcolor"></div>
					<div class="armleftlower humancolor"></div>
				</div>
				<div class="legleft">
					<div class="legleftupper pantscolor"></div>
					<div class="legleftlower humancolor"></div>
				</div>
				<div class="body tshirtcolor"></div>
				<div class="legright">
					<div class="legrightupper pantscolor"></div>
					<div class="legrightlower humancolor"></div>
				</div>
				<div class="armright">
					<div class="armrightupper tshirtcolor"></div>
					<div class="armrightlower humancolor"></div>
				</div>
			</div>

			<div class="pen"></div>

			<div style="position:absolute;top:156px;left:42px;">
				<div style="position:absolute;border:0px;border-radius:4px 4px;background-color:#ddd;width:40px;height:4px;"></div>
				<div style="position:absolute;border:0px;background-color:#ddd;width:4px;height:45px;left:5px;top:4px;"></div>
				<div style="position:absolute;border:0px;background-color:#ddd;width:4px;height:45px;left:31px;top:4px;"></div>
			</div>
			
			<div class="book">
				<div class="thick"></div>
				<div class="cover">
					<div class="yan">言</div>
					<div class="xin">心</div>
				</div>
			</div>
			
			<div class="text">
				<div style="margin:auto;width:50px;text-align:right;font-size:12px;">™️️</div>
				<img src="logo.png" style="width:40px;height:40px;"><br>
				言心<br>
				你的心灵日记<br>
				陪伴有故事的你<br>
				<br>
				<br>
				<div style="font-size:12px;transform:scale(0.9);width:100%;">心之言（上海）科技有限公司</div>
				<div style="font-size:12px;transform:scale(0.9);width:100%;">出品</div>
				<div style="font-size:12px;transform:scale(0.9);width:100%;">©️ 从 2019年 到 所有账号被回收</div>
				<div style="font-size:12px;transform:scale(0.9);width:100%;">yanxin.10o10m.com</div>
				<div style="font-size:12px;transform:scale(0.9);width:100%;">域名速记：10个圈10个美</div>
			</div>
		</div>
	<div style="position:absolute;bottom:0px;left:0;right:0px;text-align:center;color:red;font-size:14px;">这是测试版，请勿使用，正式版，即将到来，敬请期待</div>
	<div style="position:absolute;bottom:0px;left:0;right:0px;z-index:-1;color:#777;text-align:right;font-size:12px;">公安部备案中，沪ICP备案中</div>
	</div>
	</body>
</html>	
